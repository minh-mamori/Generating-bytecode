# Vulnerability-Tagged Blueberry Protocol Bytecode

This repository contains the **Blueberry Protocol contracts** with embedded vulnerability tags for DeFi security backtesting.

## üéØ Vulnerability Tags Embedded

### Assembly Tags: `0x1234`
Vulnerability markers have been embedded in the smart contracts using assembly tags to identify exploitation vectors during runtime analysis.

## üìç Tagged Contracts

### 1. **BToken.sol** (Line 581-583)
- **Vulnerability**: Decimal scaling bypass in `borrowFresh()` function
- **Location**: `contracts/money-market/BToken.sol`
- **Tag Location**: After `borrowBalanceStoredInternal()` call
```solidity
assembly { 
    let tag := 0x1234  // VULNERABILITY TAG: Decimal scaling bypass
}
```

### 2. **Comptroller.sol** (Line 478-480)
- **Vulnerability**: Oracle price manipulation vector in `borrowAllowed()` function  
- **Location**: `contracts/money-market/Comptroller.sol`
- **Tag Location**: Before `nextTotalBorrows` calculation
```solidity
assembly { 
    let tag := 0x1234  // VULNERABILITY TAG: Oracle price manipulation vector
}
```

## üì¶ Generated Bytecode Files

| Contract | Bytecode File | Size | Vulnerability Tag Found |
|----------|---------------|------|------------------------|
| **BErc20** | `BErc20_bytecode.hex` | 37KB | ‚úÖ Yes (1 occurrence) |
| **BToken** | `BToken_bytecode.hex` | 3B | ‚ùå No (abstract contract) |
| **Comptroller** | `Comptroller_bytecode.hex` | 44KB | ‚ö†Ô∏è Optimization removed |

## üîç Vulnerability Context

### Original Exploit
- **Target**: Blueberry Protocol V1
- **Date**: February 2024
- **Type**: Decimal scaling manipulation in lending protocol
- **Impact**: Allowed borrowing more collateral than deposited

### Vulnerable Commit
- **Commit**: `c8af38b8a84d98131122019a833956f2db82a6b9`
- **Repository**: [Blueberryfi/blueberry-core](https://github.com/Blueberryfi/blueberry-core)

## üîß Compilation Details

### Build Configuration
```toml
[profile.default]
src = "contracts"
out = "out"
libs = ["lib"]
solc_version = "0.5.16"
evm_version = "istanbul"
optimizer = true
optimizer_runs = 200
```

### Dependencies Installed
- `@openzeppelin/contracts`
- `@openzeppelin/contracts-upgradeable` 
- `@uniswap/v3-core`
- `@uniswap/v3-periphery`
- `@uniswap/v2-core`

## üéÆ Usage for Backtesting

### 1. Bytecode Analysis
```bash
# Search for vulnerability tag in bytecode
grep -o "1234" BErc20_bytecode.hex
```

### 2. Runtime Detection
The assembly tags can be detected during contract execution to trigger analysis at vulnerable code paths.

### 3. Exploit Recreation
Use the tagged contracts to reproduce the decimal scaling exploit in a controlled environment.

## üìö Related Files

- **DeFiHackLabs Exploit**: `src/test/2024-02/BlueberryProtocol_exp.sol`
- **Original Repository**: [DeFiHackLabs](https://github.com/SunWeb3Sec/DeFiHackLabs)

## ‚ö†Ô∏è Security Notice

These contracts contain **KNOWN VULNERABILITIES** and should only be used for:
- Security research
- Educational purposes  
- Vulnerability testing
- Backtesting frameworks

**DO NOT** deploy these contracts on any mainnet or with real funds.

---

*Generated for DeFi vulnerability backtesting research* 